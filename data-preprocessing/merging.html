<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Merging datasets - Data analysis for robotics</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Introduction</li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> Foreword</div></li><li class="chapter-item expanded "><a href="../introduction/license.html"><strong aria-hidden="true">2.</strong> License</a></li><li class="chapter-item expanded affix "><li class="part-title">Fundamentals</li><li class="chapter-item expanded "><a href="../fundamentals/variable_types.html"><strong aria-hidden="true">3.</strong> Variable types</a></li><li class="chapter-item expanded "><a href="../fundamentals/time.html"><strong aria-hidden="true">4.</strong> Time</a></li><li class="chapter-item expanded "><a href="../fundamentals/geometry.html"><strong aria-hidden="true">5.</strong> Geometry</a></li><li class="chapter-item expanded "><a href="../fundamentals/coordinate_systems.html"><strong aria-hidden="true">6.</strong> Coordinate systems</a></li><li class="chapter-item expanded affix "><li class="part-title">Coordinate Transformations</li><li class="chapter-item expanded "><a href="../transformations/motivation.html"><strong aria-hidden="true">7.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../transformations/transformation-tree.html"><strong aria-hidden="true">8.</strong> Transformation tree</a></li><li class="chapter-item expanded "><a href="../transformations/transformation-matrix.html"><strong aria-hidden="true">9.</strong> Transformation matrix</a></li><li class="chapter-item expanded "><a href="../transformations/rotation.html"><strong aria-hidden="true">10.</strong> Rotation</a></li><li class="chapter-item expanded "><a href="../transformations/time.html"><strong aria-hidden="true">11.</strong> Transformations over time</a></li><li class="chapter-item expanded "><a href="../transformations/implementation.html"><strong aria-hidden="true">12.</strong> Implementation in Python</a></li><li class="chapter-item expanded affix "><li class="part-title">Data Handling</li><li class="chapter-item expanded "><a href="../data-preprocessing/data-representation.html"><strong aria-hidden="true">13.</strong> Data representation</a></li><li class="chapter-item expanded "><a href="../data-preprocessing/interpolation.html"><strong aria-hidden="true">14.</strong> Interpolation</a></li><li class="chapter-item expanded "><a href="../data-preprocessing/merging.html" class="active"><strong aria-hidden="true">15.</strong> Merging datasets</a></li><li class="chapter-item expanded affix "><li class="part-title">Perception</li><li class="chapter-item expanded "><a href="../perception/overview.html"><strong aria-hidden="true">16.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../perception/radar.html"><strong aria-hidden="true">17.</strong> RADAR</a></li><li class="chapter-item expanded "><a href="../perception/lidar.html"><strong aria-hidden="true">18.</strong> LIDAR</a></li><li class="chapter-item expanded "><a href="../perception/sensor_fusion.html"><strong aria-hidden="true">19.</strong> Sensor Fusion</a></li><li class="chapter-item expanded "><a href="../perception/architectures.html"><strong aria-hidden="true">20.</strong> Fusion Architectures</a></li><li class="chapter-item expanded affix "><li class="part-title">Maps and Geography</li><li class="chapter-item expanded "><a href="../maps/fundamentals.html"><strong aria-hidden="true">21.</strong> Fundamentals</a></li><li class="chapter-item expanded "><a href="../maps/gps.html"><strong aria-hidden="true">22.</strong> GPS</a></li><li class="chapter-item expanded "><a href="../maps/projections.html"><strong aria-hidden="true">23.</strong> Projections</a></li><li class="chapter-item expanded "><a href="../maps/spatial_indexing.html"><strong aria-hidden="true">24.</strong> Spatial Indexing</a></li><li class="chapter-item expanded "><a href="../maps/open-street-maps.html"><strong aria-hidden="true">25.</strong> Open Street Maps</a></li><li class="chapter-item expanded affix "><li class="part-title">In-vehicle networks</li><li class="chapter-item expanded "><a href="../in-vehicle-networks/intro.html"><strong aria-hidden="true">26.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../in-vehicle-networks/can_bus.html"><strong aria-hidden="true">27.</strong> Controller Area Network</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Data analysis for robotics</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="merging-datasets"><a class="header" href="#merging-datasets">Merging datasets</a></h1>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<p>Merging two time series datasets with varying sampling frequencies can be a complex and challenging task, 
yet it is a common problem in many fields such as finance, economics, and engineering. 
Time series data refers to a sequence of observations taken at regular intervals over time. 
However, in real-world scenarios, it is not uncommon to have two or more time series datasets collected at different sampling frequencies (as in Fig. 1), 
making it difficult to combine them into a single dataset for analysis.</p>
<p>The problem of merging time series data with varying sampling frequencies arises because the data points in each dataset are not necessarily aligned, 
leading to gaps or overlapping time periods. To merge such datasets, we need to decide how to handle these gaps and overlaps while preserving the integrity of the data. 
Moreover, merging time series datasets requires careful consideration of the data quality, accuracy, and completeness, as well as the statistical properties of the data.</p>
<p>In this chapter we will deal with merging of multiple datasets with varying sample frequencies into one dataset with a predefined frequency \( f_C \)  which can be used for further investigation or analysis.</p>
<p align="center">
  <img src="./merge_datasets.svg" />
</p>
<figcaption><center>
<p><strong>Figure 1</strong>: Illustration of the merging problem discussed in this chapter. 
Dataset \( \mathbf A \) with \( N \) columns is sampled with a a frequency of \( f_A = 1 Hz \).
Dataset \( \mathbf B \) (\( M \) columns) which covers similar time period, is sampled with \( f_B = 4 Hz \).
The goal is to create a dataset C with a predefined frequency \( f_C \) which contains the information from the columns of the source datasets.</p>
</center></figcaption>
<h2 id="methodology"><a class="header" href="#methodology">Methodology</a></h2>
<p>We can solve the above mentioned problem by applying the following three steps:</p>
<ol>
<li>Decide about the target frequency \( f_C \) </li>
<li>Interpolate (Up/Downsample the data), decide for each column individually</li>
<li>Join the data by time</li>
</ol>
<p>In the subsequent sections, we will discuss some details crucial for each step.</p>
<h3 id="choice-of-the-target-frequency"><a class="header" href="#choice-of-the-target-frequency">Choice of the target frequency</a></h3>
<p>Instead of randomly selecting one of the frequencies \( f_A \) or \( f_B \) we can base our decision
on following criteria:</p>
<ul>
<li><strong>Information loss</strong>: Especially when working with high frequency data such as sound waves or road oscillations,
you want to keep the information contained in the signal. As <em>Nyquist–Shannon sampling theorem</em> states, in order to capture information from a signal represented in a specific frequency band, you need to sample the data at least twice this frequency.<sup class="footnote-reference"><a href="#nyquist-shannon">1</a></sup> For an periodic bump in the road happening each \( d = 10m \) with our vehicle driving \( v_0 = 33.3 \frac m s = 120 \frac{km}{h} \), we need to sample higher than \( f_{C, min} = 2 \frac{v_0}{d} = 6.6 Hz \).</li>
<li><strong>Computational resources</strong>: depending on the computation capacity of your machine or cluster of machines, 
you may consider a smaller target frequency to fit the data into memory or to limit the time needed for a computation.</li>
<li><strong>Consumer applications</strong>: depending on your use-case with the merged dataset, you may want to decrease or increase the frequency - usually reporting applications
use a smaller frequency as those used for video rendering where a frequency of min 30fps is desired</li>
</ul>
<h3 id="interpolation"><a class="header" href="#interpolation">Interpolation</a></h3>
<p>As discussed in the <a href="./interpolation.html">Interpolation</a> chapter, you need to decide for a suited interpolation method. A good first choice for physical signals is the <code>linear</code>, for categorical signals <code>nearest-neighbor</code> interpolation method.</p>
<p>In the context of perception and object tracking (as discussed in chapter TODO), you have to interpolate for each object ID individually. Interpolation without that consideration may lead to data loss, since the perception often tracks multiple objects at the same point in time.</p>
<h3 id="join-the-data"><a class="header" href="#join-the-data">Join the data</a></h3>
<p>Having both datasets A and B with the same time-stamps as indices we can apply a <code>JOIN</code>-like operation. Here we can to decide for <code>LEFT</code>, <code>RIGHT</code> or <code>INNER</code>-join depending on the application and use case:</p>
<ul>
<li>
<p><code>INNER</code>: returns records when there is a match in both tables.</p>
</li>
<li>
<p><code>LEFT</code>: returns all records from the left table, even if there are no matches in the right table.</p>
</li>
<li>
<p><code>RIGHT</code>: returns all records from the right table, even if there are no matches in the left table.</p>
</li>
</ul>
<p>For the latter two cases, note that the columns of the missing records will be filled with placeholder value such as <code>NaN</code> (not a number).</p>
<h2 id="implementation"><a class="header" href="#implementation">Implementation</a></h2>
<p>The pandas library provides an extensive set of functions for resampling, grouping (by <code>ID</code> for object-lists) and joining the data:</p>
<ul>
<li><strong>resampling</strong>: <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.asfreq.html"><code>pd.DataFrame.asfreq</code></a>, <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.resample.html"><code>pd.DataFrame.resample</code></a></li>
<li><strong>joining</strong>: <a href="https://pandas.pydata.org/docs/reference/api/pandas.merge.html"><code>pd.merge</code></a>, <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.join.html"><code>pd.DataFrame.join</code></a></li>
<li><strong>grouping</strong>: <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.groupby.html"><code>pd.DataFrame.groupby</code></a></li>
</ul>
<p>In addition, combined functions exist, such as <a href="https://pandas.pydata.org/docs/reference/api/pandas.merge_asof.html"><code>pd.merge_asof</code></a> which combines both the resampling and joining in one operation.</p>
<pre><code class="language-python"># we assume both dataframes have a datetime-index
# the resampling is done to the floor of 10ms
df_a = df_a.resample('10ms').interpolate('linear')
df_b = df_b.resample('10ms').nearest()

df_c = df_a.join(df_b, how='left')
</code></pre>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<p><sup class="footnote-reference"><a href="#nyquist-shannon">1</a></sup> Wikipedia - <em>Nyquist–Shannon sampling theorem</em> (<a href="https://en.wikipedia.org/wiki/Nyquist%E2%80%93Shannon_sampling_theorem">link</a>)</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../data-preprocessing/interpolation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../perception/overview.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../data-preprocessing/interpolation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../perception/overview.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
